<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Room Map Viewer</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #111;
    color: #fff;
}

header {
    padding: 10px;
    background: #222;
    text-align: center;
}

select {
    font-size: 16px;
    padding: 6px;
}

#mapContainer {
    overflow: auto;
    width: 100vw;
    height: 60vh;
    background: #000;
    touch-action: pan-x pan-y;
}

#grid {
    display: grid;
    gap: 2px;
    background: #333;
    transform-origin: 0 0;
}

.room {
    width: 40px;
    height: 40px;
    background: #444;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    cursor: pointer;
    user-select: none;
}

.room:hover {
    background: #666;
}

.room.fire { background:#8b2c2c; }
.room.water { background:#2c4f8b; }
.room.air { background:#8888cc; }
.room.earth { background:#4f8b2c; }
.room.star { background:#8b2c8b; }

#infoPanel {
    padding: 10px;
    background: #222;
    min-height: 100px;
}

#infoPanel h2 {
    margin: 0;
    font-size: 18px;
}

#infoPanel p {
    margin-top: 6px;
    color: #ccc;
}

.zoom-controls {
    position: fixed;
    bottom: 120px;
    right: 10px;
    display: flex;
    flex-direction: column;
}

.zoom-controls button {
    font-size: 18px;
    margin: 4px;
    padding: 8px;
}
</style>
</head>

<body>

<header>
    Z Level:
    <select id="zSelect"></select>
</header>

<div id="mapContainer">
    <div id="grid"></div>
</div>

<div class="zoom-controls">
    <button onclick="zoomIn()">+</button>
    <button onclick="zoomOut()">âˆ’</button>
</div>

<div id="infoPanel">
    <h2>Tap a room</h2>
    <p>Room info will appear here.</p>
</div>

<script>
let rooms = {};
let currentZ = 0;
let scale = 1;

const grid = document.getElementById("grid");
const zSelect = document.getElementById("zSelect");
const infoPanel = document.getElementById("infoPanel");

fetch("Rooms.json")
.then(res => res.json())
.then(data => {
    rooms = data;
    initZLevels();
    renderMap();
});

function initZLevels() {
    const zLevels = [...new Set(Object.values(rooms).map(r => r.z))].sort((a,b)=>a-b);
    zLevels.forEach(z => {
        const opt = document.createElement("option");
        opt.value = z;
        opt.textContent = "Z = " + z;
        zSelect.appendChild(opt);
    });
    currentZ = zLevels[0];
    zSelect.value = currentZ;
    zSelect.onchange = () => {
        currentZ = parseInt(zSelect.value);
        renderMap();
    };
}

function renderMap() {
    grid.innerHTML = "";

    const levelRooms = Object.entries(rooms)
        .filter(([id,r]) => r.z === currentZ)
        .map(([id,r]) => ({id, ...r}));

    const xs = levelRooms.map(r => r.x);
    const ys = levelRooms.map(r => r.y);

    const minX = Math.min(...xs);
    const maxX = Math.max(...xs);
    const minY = Math.min(...ys);
    const maxY = Math.max(...ys);

    const width = maxX - minX + 1;
    const height = maxY - minY + 1;

    grid.style.gridTemplateColumns = `repeat(${width}, 40px)`;
    grid.style.gridTemplateRows = `repeat(${height}, 40px)`;

    const roomMap = {};
    levelRooms.forEach(r => {
        const key = `${r.x},${r.y}`;
        roomMap[key] = r;
    });

    for(let y = maxY; y >= minY; y--) {
        for(let x = minX; x <= maxX; x++) {
            const div = document.createElement("div");
            div.className = "room";

            const key = `${x},${y}`;
            if(roomMap[key]) {
                const r = roomMap[key];
                div.textContent = r.id;
                div.classList.add(getRoomClass(r.short));
                div.onclick = () => showInfo(r);
            } else {
                div.style.background = "#111";
            }

            grid.appendChild(div);
        }
    }

    grid.style.transform = `scale(${scale})`;
}

function showInfo(room) {
    infoPanel.innerHTML = `
        <h2>Room ${room.id}</h2>
        <p>${room.short}</p>
        <p>Coordinates: (${room.x}, ${room.y}, ${room.z})</p>
    `;
}

function getRoomClass(text) {
    text = text.toLowerCase();
    if(text.includes("fire") || text.includes("volcano")) return "fire";
    if(text.includes("water") || text.includes("sea") || text.includes("reef")) return "water";
    if(text.includes("air") || text.includes("cloud") || text.includes("wind")) return "air";
    if(text.includes("earth") || text.includes("forest") || text.includes("cave")) return "earth";
    if(text.includes("star")) return "star";
    return "";
}

function zoomIn() {
    scale += 0.1;
    grid.style.transform = `scale(${scale})`;
}

function zoomOut() {
    scale = Math.max(0.4, scale - 0.1);
    grid.style.transform = `scale(${scale})`;
}
</script>

</body>
</html>
