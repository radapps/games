<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chess vs Stockfish - Custom FEN</title>
    <!-- 1. CSS for the Board -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net">
</head>
<body>
    <div id="myBoard" style="width: 400px; margin: 20px auto;"></div>
    <div style="text-align: center;">
        <p id="status">Loading Engine...</p>
    </div>

    <!-- 2. Load JQuery (Required by Chessboard.js) -->
    <script src="https://code.jquery.com"></script>
    
    <!-- 3. Load Game Logic (Chess.js) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    
    <!-- 4. Load Visual Board (Chessboard.js) -->
    <script src="https://cdn.jsdelivr.net"></script>

    <script>
        // EDIT YOUR FEN HERE
        const initialFen = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1';

        // Initialize Game Logic and Visual Board
        const game = new Chess(initialFen);
        const board = Chessboard('myBoard', {
            draggable: true,
            position: initialFen,
            onDrop: handleMove
        });

        // Initialize Engine from CDN
        const engine = new Worker('https://cdnjs.cloudflare.com/ajax/libs/stockfish.js/10.0.2/stockfish.js');
        engine.postMessage('uci');

        function handleMove(source, target) {
            const move = game.move({ from: source, to: target, promotion: 'q' });
            if (move === null) return 'snapback';

            document.getElementById('status').innerText = "Stockfish is thinking...";
            
            // Send position to engine and ask for best move
            engine.postMessage(`position fen ${game.fen()}`);
            engine.postMessage('go depth 12'); 
        }

        engine.onmessage = function(event) {
            if (event.data.startsWith('bestmove')) {
                const moveParts = event.data.split(' ');
                const bestMove = moveParts[1]; // e.g., "e2e4"
                
                game.move({
                    from: bestMove.substring(0, 2),
                    to: bestMove.substring(2, 4),
                    promotion: 'q'
                });
                
                board.position(game.fen());
                document.getElementById('status').innerText = "Your turn";
            }
        };

        engine.postMessage('isready');
    </script>
</body>
</html>
