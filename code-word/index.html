<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Code Word</title>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
    min-height: 100vh;
    padding: 20px;
    color: white;
}

.container { max-width: 800px; margin: 0 auto; }

.header { text-align:center; margin-bottom:20px; }

h1 { font-size:2.5em; margin-bottom:10px; }

.subtitle { color:#cbd5e1; }

.game-status {
    background:#334155;
    padding:15px;
    border-radius:8px;
    text-align:center;
    font-size:1.2em;
    margin-bottom:15px;
}

.winner-message {
    background:#fbbf24;
    color:#1e293b;
    padding:20px;
    border-radius:8px;
    text-align:center;
    font-size:1.5em;
    font-weight:bold;
    margin-top:20px;
}

.hidden { display:none; }

.controls {
    display:flex;
    gap:10px;
    justify-content:center;
    flex-wrap:wrap;
    margin-bottom:10px;
}

.btn {
    padding:12px 24px;
    border:none;
    border-radius:8px;
    font-size:1em;
    font-weight:600;
    cursor:pointer;
    transition:all 0.2s;
}

.btn-primary { background:#3b82f6; color:white; }
.btn-primary:hover { background:#2563eb; }

.select {
    padding:10px;
    border-radius:6px;
    border:1px solid #475569;
    background:#1e293b;
    color:white;
    font-size:1em;
}

/* Feedback rows */
#gameBoard {
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:center;
    margin:15px 0;
}

.row {
    display:flex;
    justify-content:space-between;
    width:100%;
    max-width:400px;
    background:#334155;
    padding:10px 15px;
    border-radius:8px;
    font-family: monospace;
    font-size:1.2em;
}

.pegs { letter-spacing:4px; }

/* Letter boxes */
.letter-boxes {
    display:flex;
    justify-content:center;
    gap:8px;
    margin-top:10px;
}

.letter-box {
    width:48px;
    height:48px;
    border:2px solid #cbd5e1;
    border-radius:6px;
    text-align:center;
    font-size:1.5em;
    font-weight:bold;
    line-height:48px;
    background:#1e293b;
}

/* Keyboard */
.keyboard {
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:6px;
    margin-top:20px;
}

.keyboard-row {
    display:flex;
    justify-content:center;
    gap:4px;
    width:100%;
}

.keyboard button {
    flex:1;
    height:48px;
    max-width:48px;
    border:none;
    border-radius:6px;
    background:#334155;
    color:white;
    font-weight:bold;
    cursor:pointer;
    font-size:1em;
    transition:all 0.2s;
}

.keyboard button:hover { background:#475569; }

.keyboard .wide {
    max-width:80px;
    flex:1.5;
}

#feedbackMessage {
    color:#f87171;
    margin-top:10px;
    min-height:1.2em;
    text-align:center;
}

/* Mobile tweaks */
@media (max-width:480px) {
    .letter-box { width:40px; height:40px; font-size:1.2em; line-height:40px; }
    .keyboard button { height:40px; font-size:0.9em; max-width:40px; }
}
</style>
</head>

<body>
<div class="container">

<div class="header">
    <h1>ðŸ”  Code Word</h1>
    <p class="subtitle">Mastermind with words</p>
</div>

<div id="gameStatus" class="game-status">
    Choose a word length and start a new game
</div>

<div class="controls">
    <select class="select" id="wordLength">
        <option value="4">4 Letters</option>
        <option value="5" selected>5 Letters</option>
        <option value="6">6 Letters</option>
        <option value="7">7 Letters</option>
    </select>
    <button class="btn btn-primary" id="newGameBtn">New Game</button>
</div>

<!-- Feedback rows -->
<div id="gameBoard"></div>

<!-- Letter boxes -->
<div id="letterBoxes" class="letter-boxes"></div>

<!-- Keyboard -->
<div id="keyboard" class="keyboard"></div>

<div id="feedbackMessage"></div>

<div id="winnerMessage" class="winner-message hidden">
    ðŸŽ‰ <span id="winnerText"></span>
</div>

</div>

<script>
let secretWord = "";
let wordLength = 5;
let words = [];
let usedWords = {};
let currentGuess = [];
let gameOver = false;

const gameBoard = document.getElementById("gameBoard");
const letterBoxes = document.getElementById("letterBoxes");
const keyboardDiv = document.getElementById("keyboard");
const feedbackMessage = document.getElementById("feedbackMessage");
const winnerMessage = document.getElementById("winnerMessage");
const winnerText = document.getElementById("winnerText");
const wordLengthSelect = document.getElementById("wordLength");

const keyboardRows = [
  "QWERTYUIOP".split(""),
  "ASDFGHJKL".split(""),
  "ZXCVBNM".split("")
];

document.getElementById("newGameBtn").addEventListener("click", startNewGame);
wordLengthSelect.addEventListener("change", e => wordLength = parseInt(e.target.value));

async function loadWords(length) {
    const response = await fetch(`words${length}.json`);
    const data = await response.json();
    return data.words.map(w => w.toUpperCase());
}

async function startNewGame() {
    gameOver = false;
    currentGuess = [];
    gameBoard.innerHTML = "";
    feedbackMessage.textContent = "";
    winnerMessage.classList.add("hidden");

    if (!usedWords[wordLength]) usedWords[wordLength] = [];

    try {
        words = await loadWords(wordLength);
    } catch {
        feedbackMessage.textContent = "Failed to load word list.";
        return;
    }

    const availableWords = words.filter(w => !usedWords[wordLength].includes(w));

    if (availableWords.length === 0) {
        feedbackMessage.textContent = "No more unused words left!";
        return;
    }

    secretWord = availableWords[Math.floor(Math.random() * availableWords.length)];
    console.log("Secret:", secretWord);

    createLetterBoxes();
    createKeyboard();
}

function createLetterBoxes() {
    letterBoxes.innerHTML="";
    for(let i=0;i<wordLength;i++){
        const box=document.createElement("div");
        box.className="letter-box";
        letterBoxes.appendChild(box);
    }
}

function createKeyboard() {
    keyboardDiv.innerHTML="";
    keyboardRows.forEach(row=>{
        const rowDiv=document.createElement("div");
        rowDiv.className="keyboard-row";
        row.forEach(l=>{
            const btn=document.createElement("button");
            btn.textContent=l;
            btn.onclick=()=>addLetter(l);
            rowDiv.appendChild(btn);
        });
        keyboardDiv.appendChild(rowDiv);
    });

    const lastRow = keyboardDiv.lastChild;

    const enterBtn=document.createElement("button");
    enterBtn.textContent="ENTER";
    enterBtn.className="wide";
    enterBtn.onclick=submitGuess;

    const backBtn=document.createElement("button");
    backBtn.textContent="âŒ«";
    backBtn.className="wide";
    backBtn.onclick=removeLetter;

    lastRow.appendChild(enterBtn);
    lastRow.appendChild(backBtn);
}

function addLetter(letter){
    if(gameOver || currentGuess.length>=wordLength) return;
    currentGuess.push(letter);
    updateBoxes();
}

function removeLetter(){
    if(gameOver) return;
    currentGuess.pop();
    updateBoxes();
}

function updateBoxes(){
    const boxes=document.querySelectorAll(".letter-box");
    boxes.forEach((box,i)=> box.textContent=currentGuess[i]||"");
}

function submitGuess(){
    if(gameOver) return;
    const guess=currentGuess.join("");
    feedbackMessage.textContent="";

    if(guess.length!==wordLength){
        feedbackMessage.textContent=`Guess must be ${wordLength} letters.`;
        return;
    }

    const result=evaluateGuess(guess,secretWord);
    displayResult(guess,result);

    if(result.black===wordLength){
        winnerText.textContent="You cracked the code!";
        winnerMessage.classList.remove("hidden");
        usedWords[wordLength].push(secretWord);
        gameOver=true;
        return;
    }

    currentGuess=[];
    updateBoxes();
}

function evaluateGuess(guess,secret){
    let black=0, white=0;
    const s=secret.split(""), g=guess.split("");
    const usedS=Array(wordLength).fill(false);
    const usedG=Array(wordLength).fill(false);

    for(let i=0;i<wordLength;i++){
        if(g[i]===s[i]){
            black++;
            usedS[i]=usedG[i]=true;
        }
    }

    for(let i=0;i<wordLength;i++){
        if(usedG[i]) continue;
        for(let j=0;j<wordLength;j++){
            if(!usedS[j] && g[i]===s[j]){
                white++;
                usedS[j]=true;
                break;
            }
        }
    }
    return {black,white};
}

function displayResult(guess,result){
    const row=document.createElement("div");
    row.className="row";

    const guessDiv=document.createElement("div");
    guessDiv.textContent=guess;

    const pegDiv=document.createElement("div");
    pegDiv.className="pegs";
    pegDiv.textContent="âš«".repeat(result.black)+"âšª".repeat(result.white);

    row.appendChild(guessDiv);
    row.appendChild(pegDiv);
    gameBoard.appendChild(row);
}

startNewGame();
</script>
</body>
</html>
